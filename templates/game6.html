<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceship Dodge Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: #1e1e1e;
        }

        #spaceship {
            position: absolute;
            top: 80%;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: url('static/spaceship.png') no-repeat center/contain;
            transition: all 0.3s ease;
        }

        .falling-object, .power-up {
            position: absolute;
            top: 0;
            width: 50px;
            height: 50px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        #timer, #score, #health {
            position: absolute;
            top: 10px;
            font-size: 24px;
            color: #fff;
        }

        #timer { left: 10px; }
        #score { left: 50%; transform: translateX(-50%); }
        #health { right: 10px; }

        /* Loading Screen */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            z-index: 100;
            display: none;
            animation: fade-in-out 3s infinite;
        }

        /* Cool glow and loading spinner */
        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid #fff;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1.5s linear infinite;
        }

        .loading-text {
            margin-top: 20px;
            font-size: 24px;
            animation: glow 1.5s ease-in-out infinite;
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes glow {
            0% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            100% { text-shadow: 0 0 20px rgba(255, 255, 255, 1); }
        }

        @keyframes fade-in-out {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Pulsing effect for the spaceship when shield is activated */
        .shielded {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="spaceship"></div>
        <div id="timer">Time: 50</div>
        <div id="score">Score: 0</div>
        <div id="health">Health: 3</div>
        
        <!-- Loading screen with a spinner -->
        <div id="loading-screen">
            <div class="spinner"></div>
            <div class="loading-text" id="loading-text">Loading...</div>
        </div>
    </div>

    <script>
        const spaceship = document.getElementById('spaceship');
        const gameContainer = document.getElementById('game-container');
        const loadingScreen = document.getElementById('loading-screen');
        const loadingText = document.getElementById('loading-text');
        let gameWidth = gameContainer.clientWidth;
        let gameHeight = gameContainer.clientHeight;
        let timeRemaining = 50; // 50 seconds
        let interval;
        let gameOver = false;
        let score = 0;
        let health = 3;
        let invincible = false;
        let speedMultiplier = 1;

        // Timer countdown
        function startTimer() {
            interval = setInterval(() => {
                timeRemaining--;
                document.getElementById('timer').innerText = `Time: ${timeRemaining}`;
                if (timeRemaining <= 0) {
                    clearInterval(interval);
                    showLoadingScreen('Calculating your score...', 5000, () => {
                        window.location.href = "/game10"; // Redirect after win
                    });
                }
            }, 1000);
        }

        // Moving the spaceship (touch or key controls)
        function moveSpaceship(e) {
            const touchX = e.touches ? e.touches[0].clientX : e.clientX;
            let newLeft = touchX - spaceship.offsetWidth / 2;

            if (newLeft < 0) newLeft = 0;
            if (newLeft > gameWidth - spaceship.offsetWidth) newLeft = gameWidth - spaceship.offsetWidth;
            
            spaceship.style.left = `${newLeft}px`;
        }

        // Collision Detection
        function detectCollision(fallingObj) {
            if (invincible) return false;

            const spaceshipRect = spaceship.getBoundingClientRect();
            const objRect = fallingObj.getBoundingClientRect();

            return !(
                spaceshipRect.bottom < objRect.top ||
                spaceshipRect.top > objRect.bottom ||
                spaceshipRect.right < objRect.left ||
                spaceshipRect.left > objRect.right
            );
        }

        // Power-up collision detection
        function collectPowerUp(powerUp) {
            const spaceshipRect = spaceship.getBoundingClientRect();
            const powerUpRect = powerUp.getBoundingClientRect();

            return !(
                spaceshipRect.bottom < powerUpRect.top ||
                spaceshipRect.top > powerUpRect.bottom ||
                spaceshipRect.right < powerUpRect.left ||
                spaceshipRect.left > powerUpRect.right
            );
        }

        // Create falling objects
        function createFallingObject() {
            const obj = document.createElement('div');
            obj.classList.add('falling-object');

            // Randomly choose between badshit1.png, badshit2.jpg, and badshit3.jpg
            const badImages = ['badshit1.png', 'badshit2.jpg', 'badshit3.jpg'];
            const randomImage = badImages[Math.floor(Math.random() * badImages.length)];
            obj.style.backgroundImage = `url('static/${randomImage}')`;

            obj.style.left = `${Math.random() * (gameWidth - 50)}px`; // Random X position
            gameContainer.appendChild(obj);

            let fallInterval = setInterval(() => {
                let currentTop = parseInt(obj.style.top) || 0;
                obj.style.top = `${currentTop + 5 * speedMultiplier}px`;

                if (detectCollision(obj)) {
                    clearInterval(fallInterval);
                    obj.remove();
                    health -= 1;
                    document.getElementById('health').innerText = `Health: ${health}`;
                    if (health <= 0) {
                        clearInterval(interval);
                        showLoadingScreen('Restarting...', 3000, () => {
                            location.reload(); // Reload the game after losing
                        });
                    }
                } else if (currentTop > gameHeight) {
                    clearInterval(fallInterval);
                    obj.remove(); // Remove object when it goes off screen
                    score++;
                    document.getElementById('score').innerText = `Score: ${score}`;
                }
            }, 20);
        }

        // Create power-ups (shield)
        function createPowerUp() {
            const powerUp = document.createElement('div');
            powerUp.classList.add('power-up');
            powerUp.style.backgroundImage = "url('static/shield.png')";
            powerUp.style.left = `${Math.random() * (gameWidth - 50)}px`; // Random X position
            gameContainer.appendChild(powerUp);

            let fallInterval = setInterval(() => {
                let currentTop = parseInt(powerUp.style.top) || 0;
                powerUp.style.top = `${currentTop + 3}px`;

                if (collectPowerUp(powerUp)) {
                    clearInterval(fallInterval);
                    powerUp.remove();
                    activateShield();
                } else if (currentTop > gameHeight) {
                    clearInterval(fallInterval);
                    powerUp.remove();
                }
            }, 20);
        }

        // Activate shield (invincibility)
        function activateShield() {
            invincible = true;
            spaceship.classList.add('shielded');
            setTimeout(() => {
                invincible = false;
                spaceship.classList.remove('shielded');
            }, 5000); // Shield lasts for 5 seconds
        }

        // Show loading screen with optional message and timeout
        function showLoadingScreen(message, timeout, callback) {
            loadingText.innerText = message;
            loadingScreen.style.display = 'flex';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                if (callback) callback();
            }, timeout);
        }

        // Initialize game
        function startGame() {
            showLoadingScreen('Loading...', 2000, () => {
                loadingScreen.style.display = 'none';
                startTimer();
                setInterval(createFallingObject, 1000); // Create falling objects every second
                setInterval(createPowerUp, 7000); // Create power-ups every 7 seconds
            });
        }

        // Event listeners for touch and key controls
        window.addEventListener('mousemove', moveSpaceship);
        window.addEventListener('touchmove', moveSpaceship);
        startGame();
    </script>
</body>
</html>
